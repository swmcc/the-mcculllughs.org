<div class="fixed inset-0 bg-black"
     data-controller="slideshow"
     data-slideshow-images-value="<%= @images_data.to_json %>"
     data-slideshow-gallery-title-value="<%= @slideshow.title %>"
     data-slideshow-gallery-description-value="<%= @slideshow.description %>"
     data-slideshow-interval-value="<%= @slideshow.interval %>"
     data-slideshow-audio-url-value="<%= @slideshow.audio.attached? ? url_for(@slideshow.audio) : '' %>"
     data-slideshow-autoplay-value="true"
     data-action="keydown@window->slideshow#keydown">

  <!-- Hidden audio element -->
  <% if @slideshow.audio.attached? %>
    <audio data-slideshow-target="audio" loop preload="auto">
      <source src="<%= url_for(@slideshow.audio) %>" type="<%= @slideshow.audio.content_type %>">
    </audio>
  <% end %>

  <!-- Top bar -->
  <div class="absolute top-0 left-0 right-0 p-4 flex items-center justify-between z-20">
    <div class="flex items-center gap-2">
      <% if user_signed_in? %>
        <%= link_to slideshows_path, class: "p-2 text-white/70 hover:text-white transition-colors rounded-lg hover:bg-white/10" do %>
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        <% end %>
        <%= link_to edit_slideshow_path(@slideshow), class: "p-2 text-white/70 hover:text-white transition-colors rounded-lg hover:bg-white/10", title: "Edit slideshow" do %>
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
          </svg>
        <% end %>
      <% else %>
        <div class="w-10"></div>
      <% end %>
    </div>

    <span data-slideshow-target="counter" class="text-white/70 text-sm"></span>

    <!-- Audio toggle button -->
    <% if @slideshow.audio.attached? %>
      <button data-slideshow-target="audioToggle"
              data-action="click->slideshow#toggleAudio"
              class="p-2 text-white/70 hover:text-white transition-colors rounded-lg hover:bg-white/10">
        <svg data-slideshow-target="audioIcon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"></path>
        </svg>
      </button>
    <% else %>
      <div class="w-10"></div>
    <% end %>
  </div>

  <!-- Title slide -->
  <div data-slideshow-target="titleSlide" class="absolute inset-0 flex items-center justify-center">
    <div class="text-center px-8 max-w-4xl">
      <h1 data-slideshow-target="galleryTitle" class="text-4xl sm:text-5xl md:text-6xl font-bold text-white mb-6"><%= @slideshow.title %></h1>
      <p data-slideshow-target="galleryDescription" class="text-xl sm:text-2xl text-white/70 leading-relaxed"><%= @slideshow.description %></p>
      <div class="mt-8 text-white/40 text-sm">
        <span data-slideshow-target="photoCount"><%= pluralize(@uploads.count, 'photo') %></span>
        <% if @slideshow.audio.attached? %>
          <span class="mx-2">â€¢</span>
          <span class="inline-flex items-center gap-1">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"></path>
            </svg>
            Music
          </span>
        <% end %>
      </div>

      <!-- Share link -->
      <div class="mt-6">
        <button type="button"
                onclick="navigator.clipboard.writeText('<%= public_slideshow_url(@slideshow.short_code) %>').then(() => { this.querySelector('span').textContent = 'Copied!'; setTimeout(() => this.querySelector('span').textContent = '<%= public_slideshow_url(@slideshow.short_code) %>', 2000) })"
                class="inline-flex items-center gap-2 px-4 py-2 text-white/50 hover:text-white/80 bg-white/5 hover:bg-white/10 rounded-lg transition-colors text-sm">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path>
          </svg>
          <span><%= public_slideshow_url(@slideshow.short_code) %></span>
        </button>
      </div>
      <button data-slideshow-target="startBtn"
              data-action="click->slideshow#startSavedSlideshow"
              class="mt-12 inline-flex items-center gap-3 px-8 py-4 bg-white/10 hover:bg-white/20 text-white text-lg font-medium rounded-full transition-all hover:scale-105">
        <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24">
          <path d="M8 5v14l11-7z"/>
        </svg>
        Start Slideshow
      </button>
    </div>
  </div>

  <!-- Image area -->
  <div data-slideshow-target="imageArea" class="hidden absolute inset-0 flex items-center justify-center">
    <button data-action="click->slideshow#manualPrev" class="absolute left-4 top-1/2 -translate-y-1/2 p-3 text-white/50 hover:text-white hover:bg-white/10 rounded-full transition-colors z-10">
      <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
      </svg>
    </button>

    <img data-slideshow-target="image" src="" alt="" class="max-w-[90vw] max-h-[90vh] object-contain">

    <button data-action="click->slideshow#manualNext" class="absolute right-4 top-1/2 -translate-y-1/2 p-3 text-white/50 hover:text-white hover:bg-white/10 rounded-full transition-colors z-10">
      <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
      </svg>
    </button>
  </div>

  <!-- Bottom info bar -->
  <div data-slideshow-target="infoBar" class="hidden absolute bottom-0 left-0 right-0 z-20">
    <div class="bg-gradient-to-t from-black/80 to-transparent px-6 pt-16 pb-6">
      <div class="max-w-3xl mx-auto">
        <div class="flex items-center justify-between mb-2">
          <h3 data-slideshow-target="title" class="text-white text-lg font-medium"></h3>
          <span data-slideshow-target="dateTaken" class="text-white/50 text-sm"></span>
        </div>
        <p data-slideshow-target="caption" class="text-white/70 text-sm mb-4"></p>

        <!-- Controls -->
        <div class="flex justify-center">
          <button data-action="click->slideshow#togglePause"
                  data-slideshow-target="pauseBtn"
                  class="p-3 text-white/70 hover:text-white bg-white/10 hover:bg-white/20 rounded-full transition-colors">
            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
              <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Slideshow modal target (required but hidden for saved slideshows) -->
  <div data-slideshow-target="modal" class="hidden"></div>
  <div data-slideshow-target="configModal" class="hidden"></div>
</div>

<style>
  /* Slideshow transitions - smooth and gentle */
  [data-slideshow-target="image"] {
    transition: opacity 0.6s ease-in-out, transform 0.6s ease-in-out;
  }

  /* Fade - gentle crossfade */
  .fade-out { opacity: 0; transition: opacity 0.6s ease-in-out; }
  .fade-in { animation: fadeIn 1s ease-in-out forwards; }
  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  /* Slide left - smooth glide */
  .slide-out-left { transform: translateX(-30%); opacity: 0; transition: all 0.6s ease-in-out; }
  .slide-in-left { animation: slideInLeft 1s ease-in-out forwards; }
  @keyframes slideInLeft {
    from { transform: translateX(30%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
  }

  /* Slide right - smooth glide */
  .slide-out-right { transform: translateX(30%); opacity: 0; transition: all 0.6s ease-in-out; }
  .slide-in-right { animation: slideInRight 1s ease-in-out forwards; }
  @keyframes slideInRight {
    from { transform: translateX(-30%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
  }

  /* Zoom - subtle scale */
  .zoom-out { transform: scale(0.95); opacity: 0; transition: all 0.6s ease-in-out; }
  .zoom-in { animation: zoomIn 1s ease-in-out forwards; }
  @keyframes zoomIn {
    from { transform: scale(1.05); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
  }
</style>
